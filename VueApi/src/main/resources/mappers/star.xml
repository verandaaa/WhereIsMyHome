<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.apartment.model.mapper.ApartmentMapper">

	<resultMap type="starDto" id="star">
		<result column="star_no" property="starNo"/>
		<result column="dongCode" property="dongCode"/>
		<result column="year" property="year"/>
		<result column="month" property="month"/>
		<result column="user_id" property="userId"/>
		<result column="sidoName" property="sidoName"/>
		<result column="gugunName" property="gugunName"/>
		<result column="dongName" property="dongName"/>
	</resultMap>
		
	<insert id="addStar" parameterType="starDto">
		insert into star (user_id, dongCode, year, month)
		values (#{userId}, #{dongCode}, #{year}, #{month})
	</insert>
	
	<select id="listStar" parameterType="string" resultMap="star">
		select s.star_no, d.dongCode, d.sidoName, d.gugunName, d.dongName, s.year, s.month
		from dongcode d join star s
		on d.dongCode = s.dongCode
		where user_id = #{userId}
	</select>
	
	<delete id="deleteStar" parameterType="int">
		delete from star
		where star_no = #{starNo}
	</delete>
	
	<select id="listAll" parameterType="map" resultMap="house">
		select hd.no,hd.aptCode,hd.dealAmount,hd.dealYear,hd.dealMonth,hd.dealDay,hd.area,hd.floor
		,hi.apartmentName ,d.dongName ,hi.roadName,hi.roadNamebonbun 
		from housedeal as hd
		join houseinfo as hi on hd.aptCode=hi.aptCode 
		join dongcode d on hi.dongCode = d.dongCode 
		where hi.dongCode = #{dong}
		and hd.dealYear like concat ('%', #{year}, '%')
		and hd.dealMonth like concat ('%', #{month}, '%')
		and hi.apartmentName like concat ('%', #{aptName}, '%')
		order by d.dongName, hi.apartmentName
	</select>
	
</mapper>